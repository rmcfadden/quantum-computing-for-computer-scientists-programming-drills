<html>
  <head>
      <title>Rotations</title>
    
      <style>
        body, html {
          font-size: 11pt;
          height: 100%;
          width: 100%;
          margin: 0;
          padding:0;
        }

        #graph {
          position:fixed;
          left:0;
          top:0;
          width:100%;
          height:100%;
        }

        #main {
          margin: 0;
          padding:0;
        }

        #controls-div {
          position: absolute;
          width: 300px;
          border: dotted 1px grey;
          border-radius: .25em;
          height: 80px;
          bottom: 2em;
          right: 2em;
          padding: 1em;
          background-color: lightgrey;
        }

        #add-shape-div {
          display:flex;
          flex-direction: row;
          align-items: center;
          gap: .5em;
        }


        #add-button {
          color: white;
          padding: .25em;
          padding-left: .5em;
          padding-right: .5em;
          background-color: grey;
          border-radius: .25em;
          border-color: grey;
          cursor: pointer;
        }

        #ädd-shape-label {
          font-weight: bold;
        }

      </style>
    </head>
    <body>
      <div id="main">
        <canvas id="canvas"></canvas>
        <div id="controls-div">
          <div id="add-shape-div">
            <span id="ädd-shape-label">Add a shape:</span>
            <select id="shape-select">
              <option>Square</option>
              <option>Circle</option>
              <option>Triangle</option>
            </select>
            <button id="add-button" onclick="addShape()">Add</button>
          </div>
          <div id="rotate-div">
          </div>
          <span id="ädd-shape-label">Rotate:</span>
          <button id="add-button" onclick="rotateLeft()">Left</button>
          <button id="add-button" onclick="rotateRight()"></button>

        </div>
      </div>

    <script>
      let shapes = [];
      const xMin = -5;
      const xMax = 5;
      const yMin = -5;
      const yMax = 5;

      const init = () => {
        const canvas = document.getElementById("canvas");
        canvas.width = document.body.clientWidth; 
        canvas.height = document.body.clientHeight;
      }

      const draw = () => {
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        context.clearRect(0,0, canvas.width, canvas.height);

        drawAxis();
        shapes.forEach(s => drawShape(s));
      }

      const drawShape = (shape) => {
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        const drawsLooksup = {
          square: (shape, context) => {
            const {
              xCartToScreenScale,
              yCartToScreenScale 
            } 
            = c2sInfo();
            const {x,y, width, height } = shape;
            const {x:xS, y:yS} = c2s({x,y});
            context.strokeStyle = 'red';
            context.beginPath();
            context.rect(xS,yS, width * xCartToScreenScale, height * yCartToScreenScale)
            context.stroke();
          },
          circle: (shape, context) => {
            const {
              xCartToScreenScale,
              yCartToScreenScale 
            } 
            = c2sInfo();
            const {x,y, radius } = shape;
            const {x:xS, y:yS} = c2s({x,y});
            context.beginPath();
            context.arc(xS,yS, radius * xCartToScreenScale, 0, 2 * Math.PI);
            context.stroke();
          },
          triangle: () => ({type: 'triangle', tx: 5, ty:5, lx:-5, ly:-5, rx:5, ry:-5}),        
        };

        drawsLooksup[shape.type.toLowerCase()](shape, context);
      }

      const drawAxis = () => {
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        const {x:xSMin, y:ySMin} = c2s({x:xMin,y:yMin});
        const {x:xSMax, y:ySMax} = c2s({x:xMax,y:yMax});
        
        for(let i = xMin; i <= xMax; i++) {
          const {x:xCurrent} = c2s({x:i,y:0});
          context.strokeStyle = i === 0 ? 'grey' : 'lightgray' 
          context.beginPath();
          context.moveTo(xCurrent, ySMin)
          context.lineTo(xCurrent, ySMax);
          context.stroke();
        }          
        
        for(let i = yMin; i <= yMax; i++) {
          const {y:yCurrent} = c2s({x:0,y:i});
          context.strokeStyle = i === 0 ? 'grey' : 'lightgray' 
          context.beginPath();
          context.moveTo(xSMin,yCurrent)
          context.lineTo(xSMax,yCurrent);
          context.stroke();
        }          
      }

      const addShape = ()  => {
        const shapesLookup = {
          square: ({width, height}) => ({type: 'square', width, height}),
          circle: () => ({type: 'circle', radius: 2.5}),
          triangle: () => ({type: 'triangle', tx: 5, ty:5, lx:-5, ly:-5, rx:5, ry:-5}),
        };

        const shapeRatio = 1 / 8;
        const {cartHeight, cartWidth } =c2sInfo();
        const shapeHeight = cartHeight * shapeRatio;
        const shapeWidth = cartWidth * shapeRatio;

        const {selectedIndex, options} = document.getElementById("shape-select");
        const {text: shapeText} = options[selectedIndex];
        shapes = [ {x: -2.5, y:2.5, ...shapesLookup[shapeText.toLowerCase()]({width: shapeWidth,height:shapeHeight })}, ...shapes];
        draw();
      }

      const rotateLeft = () => rotate(Math.PI / 18);
      const rotateRight = () => rotate(Math.PI / 18);
      const rotate = (radians) = {

      }

      const getCartesianToScreenInfo =  (cartCoords, screenCoords)  => {
        const cartWidth = Math.max(cartCoords.x1,cartCoords.x2) -  Math.min(cartCoords.x1,cartCoords.x2);
        const cartHeight = Math.max(cartCoords.y1,cartCoords.y2) -  Math.min(cartCoords.y1,cartCoords.y2);
        const screenWidth = screenCoords.x2;
        const screenHeight = screenCoords.y2;        
        const xCartToScreenScale = cartWidth === 0 ? 0 : screenWidth / cartWidth;
        const yCartToScreenScale = cartHeight === 0 ? 0 : screenHeight / cartHeight;
        return {
          cartWidth,
          cartHeight,
          screenWidth,
          screenHeight,
          xCartToScreenScale,
          yCartToScreenScale,
        };
      }

      const cartesianToScreen = (point, cartCoords, screenCoords) => {
        const { 
          cartWidth,
          cartHeight,
          screenWidth,
          screenHeight,
          xCartToScreenScale,
          yCartToScreenScale 
        } = getCartesianToScreenInfo(cartCoords, screenCoords)
        const {x, y} = point;
        return {
            x: x * xCartToScreenScale + screenWidth / 2, 
            y: -1 * y * yCartToScreenScale + screenHeight / 2
        };
      }
      
      window.addEventListener('resize', () => {
        const canvas = document.getElementById("canvas");
        canvas.width = document.body.clientWidth; 
        canvas.height = document.body.clientHeight;
        draw();
      }, false);

      const c2sInfo = ()  => {
        const canvas = document.getElementById("canvas");
        return getCartesianToScreenInfo({x1: xMin, y1: yMin, x2: xMax, y2: yMax },{x1:0,y1:0,x2:canvas.width,y2: canvas.height })      
      }
      
      const c2s = (point) => { 
        const canvas = document.getElementById("canvas");
        return cartesianToScreen(point, 
          {x1: xMin, y1: yMin, x2: xMax, y2: yMax },
          {x1:0,y1:0,x2:canvas.width,y2: canvas.height }
        );
      }

      window.addEventListener('mousedown', (e) => {
      });

      window.addEventListener('mousemove', (e) => {
      });

      window.addEventListener('mouseup', (e) => {
      });


      // Move https://dzone.com/articles/making-and-moving-selectable

      init();
      draw();

    </script>  
  </body>

</html>




